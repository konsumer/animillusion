<html>
<head>
	<title>Animated Illusion Maker</title>
<style>
	canvas {
		margin: 10px auto;
		border: 1px solid red;
	}

	#cScreen {
		position:absolute;
		left:0;
	}
</style>
</head>
<body>
<ul>
<li><a href="javascript:dl('image')" id="lImage">image</a></li>
<li><a href="javascript:dl('screen')" id="lScreen">screen</a></li>
</ul>

<canvas id="cImage"></canvas>
<canvas id="cScreen"></canvas>

</body>

<script>

// SETTINGS

// your images, should all be same size
var images = ["cat/tmp-0.gif","cat/tmp-1.gif","cat/tmp-2.gif","cat/tmp-3.gif","cat/tmp-4.gif","cat/tmp-5.gif","cat/tmp-6.gif","cat/tmp-7.gif"];

// size of slit in paper, in pixels
frameWidth = 3;




var c = document.getElementById('cImage');
var c2 = document.getElementById('cScreen');

function dl(a){
	var cv = c2;
	if (a == "image"){
		var cv = c;
	}
	var d=cv.toDataURL("image/png");
	var w=window.open('about:blank','image from canvas');
	w.document.write("<img src='"+d+"' alt='from canvas'/>");
}



window.onload = function(){
	function loadImages(ims, cb){
		var images=[];
		ims.forEach(function(i,x){
			var img = new Image();
			img.onload = function() {
				images.push(img);
				if (x == ims.length-1){
					cb(images);
				}
			}
			img.src = i;
		});
	}

	loadImages(images, function(images){
		
		c.width = images[0].width;
		c.height = images[0].height;
		document.body.appendChild(c);
		var ctx=c.getContext("2d");

		
		c2.width = images[0].width;
		c2.height = images[0].height;
		document.body.appendChild(c2);
		var ctx2=c2.getContext("2d");
		ctx2.fillStyle = "#000";

		document.body.onmousemove=function(e){
			c2.style.left = e.x-(c2.width/2);
		};

		images.sort(function(a,b){ if (a.src < b.src){ return -1; }else if (a.src > b.src){ return 1; } else { return 0; } });

		var sourceX=0;

		// draw illusion
		images.forEach(function(img, i){
			for (x=0;x<c.width;x+=(images.length*frameWidth)+i){
				ctx.drawImage(img, x, 0, frameWidth, c.height, x, 0, frameWidth, c.height);
			}
		});

/*
		i=0;
		setInterval(function(){
			i++;
			ctx.drawImage(images[i % images.length], 0, 0, c.width, c.height, 0, 0, c.width, c.height);
		},200);
*/

		// draw stripes
		

		for (x=0;x<=c.width;x+=images.length+frameWidth ){
			ctx2.fillRect (x,0,images.length,c.height);
		}
	})

}
</script>