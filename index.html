<html>
<head>
	<title>Animated Illusion Maker</title>
<style>
	body {
		font-family: sans-serif;
		width: 960;
		margin: 10px auto;
	}	
	canvas {
		margin: 10px auto;
	}

	#cScreen {
		position:absolute;
		left:0;
	}
	output {
		text-align:center;
	}

	li {
		list-style:none;
		display:inline-block;
		margin-right: 10px;
	}
	img {
		width: 100px;
	}
</style>
</head>
<body>
	<h1>Animated Illusion Maker</h1>
	<p>Choose multiple files for the frames, and the animation will be updated with whatever you selected. It tends to work well with less than 10 frames, but your animation may work with more, especially if you make it really big (in terms of pixels.) Sillouettes, especially in colors other than black work really well, even with many frames. Make sure all the frames are the same pixel size. Most browsers will allow you to simply drag &amp; drop to the file input. When you are satisfied with the animation, you can click the "image" and "screen" links, below. Print "screen" on transparency plastic, and "image" on paper.</p>
	<ul>
		<li><a href="javascript:dl('image')" id="lImage">image</a></li>
		<li><a href="javascript:dl('screen')" id="lScreen">screen</a></li>
	</ul>
	<div>
		<label for="files[]">Files:</label>
		<input type="file" id="files" name="files[]" multiple />
	</div>
	<div>
		<output id="images"></output>
	</div>
	<canvas id="cImage"></canvas>
	<canvas id="cScreen"></canvas>
</body>




<script>

// SETTINGS

// your images, should all be same size
var images = ["cat/tmp-0.gif","cat/tmp-1.gif","cat/tmp-2.gif","cat/tmp-3.gif","cat/tmp-4.gif","cat/tmp-5.gif","cat/tmp-6.gif","cat/tmp-7.gif"];

// size of slit in paper, in pixels
slitSize = 1;

// DND & file

function handleDragOver(evt) {
	evt.stopPropagation();
	evt.preventDefault();
	evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
}

function handleFileSelect(evt) {
	var files = evt.target.files; // FileList object

	images=[];

	// Loop through the FileList and render image files as thumbnails.
	for (var i = 0, f; f = files[i]; i++) {

	  // Only process image files.
	  if (!f.type.match('image.*')) {
	    continue;
	  }

	  var reader = new FileReader();
	 

	  // Closure to capture the file information.
	  reader.onload = (function(theFile) {
	    return function(e) {
	      images.push(e.target.result);
	      if (i==files.length){
	      	updateAll();
	      }
	    };
	  })(f);

	  // Read in the image file as a data URL.
	  reader.readAsDataURL(f);
	}
	
}

// Setup the dnd listeners.
var dropZone = document.getElementById('images');
dropZone.addEventListener('dragover', handleDragOver, false);
dropZone.addEventListener('drop', handleFileSelect, false);

document.getElementById('files').addEventListener('change', handleFileSelect, false);

// canvas stuff

var c = document.getElementById('cImage');
var c2 = document.getElementById('cScreen');

function dl(a){
	var cv = c2;
	if (a == "image"){
		var cv = c;
	}
	var d=cv.toDataURL("image/png");
	var w=window.open('about:blank');
	w.document.write("<img src='" + d + "' alt='from canvas'/>");
}

function updateAll(){
	function loadImages(ims, cb){
		var images=[];
		ims.forEach(function(i,x){
			var img = new Image();
			img.onload = function() {
				images.push(img);
				if (x == ims.length-1){
					cb(images);
				}
			}
			img.src = i;
		});
	}

	loadImages(images, function(images){
		var imgs=document.getElementById('images');
		imgs.innerHTML="";
		images.forEach(function(img){
			imgs.appendChild(img);
		});

		c.width = images[0].width;
		c.height = images[0].height;
		document.body.appendChild(c);
		var ctx=c.getContext("2d");
		
		c2.width = images[0].width;
		c2.height = images[0].height;
		document.body.appendChild(c2);
		var ctx2=c2.getContext("2d");
		ctx2.fillStyle = "#000";

		document.body.onmousemove=function(e){
			c2.style.left = e.x-(c2.width/2);
		};

		for (x=0;x<c.width;x+=images.length){
			images.forEach(function(img, i){
				ctx.drawImage(img, x+i, 0, slitSize , c.height, x+i, 0, slitSize , c.height);
			});
			ctx2.fillRect (x,0,images.length-slitSize,c.height);
		}
	});
}


window.onload = function(){
	updateAll();
}
</script>